<!doctype html>
<html lang="en">    
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Chat test page</title>
</head>
  <body>
    <h1>Test chat page</h1>
    <div id="messenger"></div>  
    <script>
       (function(d,t) {
            var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
            g.src="https://test.ca.one-stop-talk.sbx.gcp.trchq.com/embed.js"
            s.parentNode.insertBefore(g,s);
            g.onload=function(){
              window.virtualCareMessenger = new window.VirtualCareMessengerEncrypted({
            domain: 'https://test.ca.one-stop-talk.sbx.gcp.trchq.com',
            ws:  'wss://test.ca.one-stop-talk.sbx.gcp.trchq.com/cable',
            app_id: "XnA6d2mEejaov78UETAzM5uj",
                lang: "en",
                mode: "fullscreen",
                wrapperId: "messenger"
              });
            }
            g.onerror = () => {
              alert('Failed to load messenger')
            }
          })(document,"script");
      </script>
      <script>
        (() => {
        const limit = 1000 * 5; // 5 seconds
        const start = Date.now();
        let elapsed = 0;
        function check() {
          elapsed = Date.now() - start;
          if (elapsed > limit) {
            alert('did not load');
            return;
          }
            setTimeout(() => {
                if (document.querySelector('#messenger > div > iframe')) {
                  alert('loaded');
                } else {
                  check();
                }
            }, 500);
          }
          check();   
        })();
    </script>
  </body>
</html>
